<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>YouTube 채널 영상 정렬기</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, button, textarea { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    textarea { height: 120px; }
  </style>
</head>
<body>
  <h2>YouTube 채널 영상 (오래된 순)</h2>
  <input type="text" id="channelId" placeholder="채널 ID 입력 (예: UC_x5XG1OV2P6uZZ5FSM9Ttw)">
  <button onclick="fetchVideos()">영상 불러오기</button>

  <ul id="videoList"></ul>
  <h3>복사해서 재생목록에 붙여넣기</h3>
  <textarea id="playlistLinks" readonly></textarea>

  <script>
    const apiKey = "AIzaSyC29ZNxxQ4sVqokPzZrVxLCYsOmToPDwUs";

    async function fetchVideos() {
      const channelId = document.getElementById('channelId').value.trim();
      const videoList = document.getElementById('videoList');
      const playlistLinks = document.getElementById('playlistLinks');
      videoList.innerHTML = '<li>로딩 중...</li>';
      playlistLinks.value = '';

      try {
        const uploadsPlaylist = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${apiKey}`)
          .then(res => res.json())
          .then(data => data.items[0].contentDetails.relatedPlaylists.uploads);

        let videos = [];
        let nextPageToken = '';
        do {
          const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsPlaylist}&maxResults=50&pageToken=${nextPageToken}&key=${apiKey}`;
          const res = await fetch(url).then(r => r.json());
          videos = videos.concat(res.items);
          nextPageToken = res.nextPageToken;
        } while (nextPageToken);

        videoList.innerHTML = '';
        videos.reverse();

        let allLinks = [];
        videos.forEach(item => {
          const title = item.snippet.title;
          const videoId = item.snippet.resourceId.videoId;
          const url = `https://www.youtube.com/watch?v=${videoId}`;
          const li = document.createElement('li');
          li.innerHTML = `<a href="${url}" target="_blank">${title}</a>`;
          videoList.appendChild(li);
          allLinks.push(url);
        });

        playlistLinks.value = allLinks.join('\n');

      } catch (err) {
        videoList.innerHTML = `<li>에러 발생: ${err.message}</li>`;
      }
    }
  </script>
</body>
</html>
